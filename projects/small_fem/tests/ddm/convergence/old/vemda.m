%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% GetDP vs SmallFEM         %%
%% Vectorial EMDA: 4 domains %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

clear all;
close all;

getdp = ...
    [
        3.851487313097e+02
        2.709779462731e+02
        2.199730700126e+02
        5.780472034552e+01
        4.041480219916e+01
        1.767914164200e+01
        1.249159181126e+01
        8.890394900868e+00
        6.893231775956e+00
        5.903703778212e+00
        5.186365034135e+00
        4.651855638475e+00
        4.219926191922e+00
        3.824077016401e+00
        3.473740122290e+00
        3.152599053120e+00
        2.873826426907e+00
        2.643889712843e+00
        2.453457551373e+00
        2.287457630765e+00
        2.150053040689e+00
        2.022061431165e+00
        1.910424628720e+00
        1.797594292294e+00
        1.694414918940e+00
        1.592220129839e+00
        1.497619848901e+00
        1.407542052532e+00
        1.327219320145e+00
        1.248762458468e+00
        1.179824160112e+00
        1.107701581424e+00
        1.042314384624e+00
        9.761412790833e-01
        9.177432059792e-01
        8.586500851544e-01
        8.057070154808e-01
        7.549813035466e-01
        7.093724302230e-01
        6.653106621372e-01
        6.254997731271e-01
        5.864631004725e-01
        5.503482801867e-01
        5.159700026599e-01
        4.853459088758e-01
        4.559340272042e-01
        4.308513935567e-01
        4.062061411547e-01
        3.845227096036e-01
        3.632372954750e-01
        3.440396284270e-01
        3.248897182431e-01
        3.078999494621e-01
        2.908890188027e-01
        2.761013339311e-01
        2.612710002851e-01
        2.482099279533e-01
        2.352065897221e-01
        2.236966501487e-01
        2.118957904809e-01
        2.013292074337e-01
        1.903326720102e-01
        1.802628477967e-01
        1.700087024052e-01
        1.607425949189e-01
        1.514411158606e-01
        1.432586233118e-01
        1.351143831889e-01
        1.280520970394e-01
        1.208543166495e-01
        1.147098797626e-01
        1.082111442232e-01
        1.026450411243e-01
        9.679608153294e-02
        9.178396108441e-02
        8.663878289370e-02
        8.223301925307e-02
        7.769637212897e-02
        7.363414813877e-02
        6.968502343869e-02
        6.609958868598e-02
        6.265500550947e-02
        5.953236877722e-02
        5.647964726694e-02
        5.383580174305e-02
        5.109476139165e-02
        4.865495876188e-02
        4.609056469966e-02
        4.380286728216e-02
        4.141829041241e-02
        3.931561940379e-02
        3.718700563096e-02
        3.538166569947e-02
        3.350782088147e-02
        3.192103741920e-02
        3.025551466122e-02
        2.880779175063e-02
        2.729221119686e-02
        2.593853705552e-02
        2.452125822558e-02
        2.327963654637e-02
        2.196937188311e-02
        2.084219649525e-02
        1.966878850921e-02
        1.866633271376e-02
        1.763416700973e-02
        1.672850145765e-02
        1.584319696761e-02
        1.505567952474e-02
        1.426780153882e-02
        1.358693617064e-02
        1.287505062032e-02
        1.227231628349e-02
        1.161977468037e-02
        1.106380657154e-02
        1.048448163537e-02
        9.973831619322e-03
        9.449315481041e-03
        8.987001109372e-03
        8.520580448347e-03
        8.097943072024e-03
        7.676590365550e-03
        7.298714805328e-03
        6.910618073970e-03
        6.563517711141e-03
        6.206595796483e-03
        5.892917884310e-03
        5.572074916244e-03
        5.283009946767e-03
        5.001413491559e-03
        4.752439628921e-03
        4.507671630709e-03
        4.295982765059e-03
        4.081534253843e-03
        3.896542140697e-03
        3.699387570354e-03
        3.526333653191e-03
        3.343189678881e-03
        3.182517035812e-03
        3.013901439193e-03
        2.867838980994e-03
        2.715989662334e-03
        2.583141506863e-03
        2.447766565958e-03
        2.328629182248e-03
        2.207343289282e-03
        2.100594322569e-03
        1.993238749100e-03
        1.895996644308e-03
        1.798906537993e-03
        1.710258585810e-03
        1.622001483177e-03
        1.541801052591e-03
        1.461114889128e-03
        1.390184644553e-03
        1.317817476393e-03
        1.254916138544e-03
        1.190856482956e-03
        1.134681270662e-03
        1.077519244043e-03
        1.027056825377e-03
        9.749811796198e-04
        9.285424801950e-04
        8.812717176547e-04
        8.379973459136e-04
        7.947793181619e-04
        7.563651322322e-04
        7.171416652496e-04
        6.830966731583e-04
        6.486551281764e-04
        6.176129824532e-04
        5.870611991782e-04
        5.593023592486e-04
        5.312382297589e-04
        5.066498059622e-04
        4.808884839662e-04
        4.581975209859e-04
        4.346075176289e-04
        4.135984342919e-04
        3.922533108053e-04
        3.736199587984e-04
        3.544733710886e-04
        3.382437006850e-04
        3.210436918269e-04
        3.060972304677e-04
        2.904944983229e-04
        2.765489866586e-04
        2.622593239591e-04
        2.497242412616e-04
        2.369180581790e-04
        2.257825332811e-04
        2.143679203746e-04
        2.043301271661e-04
        1.940890396501e-04
        1.849706697883e-04
        1.756213958485e-04
        1.673107581348e-04
        1.587818082137e-04
        1.513271857885e-04
        1.436679011485e-04
        1.370923513694e-04
        1.302725806708e-04
        1.243644158298e-04
        1.181263566281e-04
        1.126108937873e-04
        1.067985020962e-04
        1.016579259382e-04
        9.630475436379e-05
        9.166572664489e-05
        8.687114176021e-05
        8.276821863576e-05
        7.859134514283e-05
        7.492315345775e-05
        7.119891131979e-05
        6.792185368811e-05
        6.445779384695e-05
        6.141542950228e-05
        5.818754386039e-05
        5.540682033308e-05
        5.247991216915e-05
        4.993248933689e-05
        4.727323249934e-05
        4.502865022189e-05
        4.268711089445e-05
        4.068926935056e-05
        3.862091647484e-05
        3.684688246925e-05
        3.498354670224e-05
        3.337891961766e-05
        3.164546063130e-05
        3.015683955822e-05
        2.855392160512e-05
        2.718409708390e-05
        2.574825212898e-05
        2.451526976598e-05
        2.323434483047e-05
        2.212453347999e-05
        2.098857081727e-05
        2.001634072772e-05
        1.899350388574e-05
        1.811025993407e-05
        1.718948316776e-05
        1.639097536348e-05
        1.554396670115e-05
        1.481472356637e-05
        1.404270288656e-05
        1.337289943422e-05
        1.267353462150e-05
        1.206697793530e-05
        1.144207571037e-05
        1.090120553990e-05
        1.033793805210e-05
        9.846633118307e-06
        9.341253329601e-06
        8.890450802808e-06
        8.431388717481e-06
        8.029425764711e-06
        7.609995809102e-06
        7.250235005113e-06
        6.864517145606e-06
        6.533905173825e-06
        6.183570594261e-06
        5.880477379259e-06
        5.570583171547e-06
        5.301311369580e-06
        5.029110115391e-06
        4.788767641590e-06
        4.544168617005e-06
        4.324872314736e-06
        4.097792569336e-06
        3.896964592174e-06
        3.686650374623e-06
        3.503308548614e-06
        3.313056250246e-06
        3.146196609785e-06
        2.976932239542e-06
        2.828511381753e-06
        2.680080277149e-06
        2.550784400192e-06
        2.417806267070e-06
        2.301515947984e-06
        2.181714758704e-06
        2.075307876547e-06
        1.964511282754e-06
        1.868726460500e-06
        1.767277518193e-06
        1.680383625948e-06
        1.588563175616e-06
        1.509979896026e-06
        1.428035958825e-06
        1.357548966693e-06
        1.285575722844e-06
        1.222595614869e-06
        1.157850901634e-06
        1.101288584116e-06
        1.041987417732e-06
        9.887634264751e-07
        9.345266805223e-07
        8.849689990985e-07
        8.351253540516e-07
        7.903590363937e-07
        7.457043579473e-07
        7.069576053583e-07
        6.672887625235e-07
        6.340365494310e-07
        5.989686387289e-07
        5.696365232919e-07
        5.385576044705e-07
        5.120398056578e-07
        4.844498138971e-07
        4.601462733884e-07
        4.350525870280e-07
        4.127552729275e-07
        3.900311658247e-07
        3.702123084053e-07
    ];

smallfem = ...
    [
        2.418275778463e+01
        1.706689274967e+01
        1.391416183341e+01
        3.501164341149e+00
        2.444157911005e+00
        1.059982734218e+00
        7.445187862012e-01
        5.196651415515e-01
        3.951024749411e-01
        3.316653240619e-01
        2.856463321087e-01
        2.532692329391e-01
        2.283651319758e-01
        2.058108347289e-01
        1.865137078605e-01
        1.682453847425e-01
        1.523374800952e-01
        1.389060505565e-01
        1.275392119437e-01
        1.177068760982e-01
        1.097380137645e-01
        1.025328198140e-01
        9.650279606103e-02
        9.061352309615e-02
        8.537129399237e-02
        8.030365969922e-02
        7.555620366917e-02
        7.098798339695e-02
        6.694440242931e-02
        6.301269766072e-02
        5.965712410378e-02
        5.611585992436e-02
        5.299553805065e-02
        4.973558187729e-02
        4.683277915456e-02
        4.381088241512e-02
        4.107962227287e-02
        3.842283147301e-02
        3.604189922950e-02
        3.377057071848e-02
        3.169752813824e-02
        2.971770260034e-02
        2.788398184497e-02
        2.610388211802e-02
        2.453107922910e-02
        2.298619996829e-02
        2.169466593597e-02
        2.041528564183e-02
        1.931605288196e-02
        1.823015124820e-02
        1.726737057802e-02
        1.630008064263e-02
        1.543922897891e-02
        1.456013350546e-02
        1.379406270005e-02
        1.302274806887e-02
        1.235358291561e-02
        1.168763542859e-02
        1.111474893986e-02
        1.053451423532e-02
        1.002509932137e-02
        9.492756132715e-03
        9.007367732220e-03
        8.502700396352e-03
        8.039310326353e-03
        7.571367963873e-03
        7.161629464310e-03
        6.745914169473e-03
        6.396886984142e-03
        6.037355931737e-03
        5.737145615180e-03
        5.413569594751e-03
        5.135967898915e-03
        4.844499777633e-03
        4.587568930559e-03
        4.322043944463e-03
        4.093052803075e-03
        3.859385465613e-03
        3.648826379613e-03
        3.444214947071e-03
        3.262098098464e-03
        3.081101218555e-03
        2.924069145681e-03
        2.766455171469e-03
        2.632489634964e-03
        2.494292646212e-03
        2.373839066046e-03
        2.247657308199e-03
        2.136366333760e-03
        2.020282853207e-03
        1.919816843341e-03
        1.815265667125e-03
        1.726980903134e-03
        1.635773023726e-03
        1.558210022085e-03
        1.477116534490e-03
        1.406814063435e-03
        1.333206112884e-03
        1.268176640614e-03
        1.199836901851e-03
        1.140150857616e-03
        1.076909232048e-03
        1.023170395960e-03
        9.651757150999e-04
        9.153622782920e-04
        8.644295632403e-04
        8.189491690276e-04
        7.740626240804e-04
        7.351485137077e-04
        6.952926692109e-04
        6.617539698739e-04
        6.260897071559e-04
        5.962072063107e-04
        5.643701150504e-04
        5.369829787964e-04
        5.089883969340e-04
        4.842245757560e-04
        4.588352047628e-04
        4.363231084263e-04
        4.134362494428e-04
        3.927257400695e-04
        3.717479866754e-04
        3.532310828078e-04
        3.338717364401e-04
        3.168068861773e-04
        2.990649438958e-04
        2.834568061194e-04
        2.674992514509e-04
        2.531830408175e-04
        2.391637207651e-04
        2.270524479510e-04
        2.149729797498e-04
        2.047380927642e-04
        1.942656227912e-04
        1.854359526899e-04
        1.760033383721e-04
        1.677088992850e-04
        1.590325761433e-04
        1.514250857112e-04
        1.434011471738e-04
        1.364668474559e-04
        1.292583165326e-04
        1.229476435353e-04
        1.164520418926e-04
        1.107062642272e-04
        1.048199282358e-04
        9.952728523394e-05
        9.429198703940e-05
        8.952024403317e-05
        8.485099679230e-05
        8.061232844859e-05
        7.636583697771e-05
        7.260698246462e-05
        6.877955753791e-05
        6.544820566341e-05
        6.200321830881e-05
        5.903876971567e-05
        5.597335112906e-05
        5.329265554024e-05
        5.057589213946e-05
        4.819531714671e-05
        4.572623861904e-05
        4.351309809312e-05
        4.124609287601e-05
        3.922291505890e-05
        3.718566401656e-05
        3.539308738203e-05
        3.355444529283e-05
        3.195599125927e-05
        3.033569295215e-05
        2.888587970530e-05
        2.745145572177e-05
        2.616243249594e-05
        2.481488237877e-05
        2.366626181683e-05
        2.244623673666e-05
        2.138685571769e-05
        2.028866543058e-05
        1.933337189653e-05
        1.835052491866e-05
        1.750181741499e-05
        1.661546351897e-05
        1.587231221936e-05
        1.508691340933e-05
        1.439525742647e-05
        1.367710928557e-05
        1.302598546473e-05
        1.235776097311e-05
        1.176431745734e-05
        1.116228594486e-05
        1.063786314178e-05
        1.009329021658e-05
        9.615959522447e-06
        9.127692750021e-06
        8.697895802993e-06
        8.257253675172e-06
        7.871547268769e-06
        7.473969226475e-06
        7.131236222539e-06
        6.772445585803e-06
        6.467880621343e-06
        6.147516562710e-06
        5.868368145836e-06
        5.578700606204e-06
        5.321013532657e-06
        5.052882808612e-06
        4.817931525190e-06
        4.570682955869e-06
        4.356754716102e-06
        4.135915975849e-06
        3.946371704629e-06
        3.750909062198e-06
        3.579657145043e-06
        3.404246426762e-06
        3.249850115864e-06
        3.086318686428e-06
        2.943664026279e-06
        2.789054310067e-06
        2.657838682081e-06
        2.516710150640e-06
        2.397005465789e-06
        2.269192204539e-06
        2.161167481515e-06
        2.048638037827e-06
        1.953545817767e-06
        1.855024688201e-06
        1.770815050524e-06
        1.681244536039e-06
        1.604799650599e-06
        1.520114357609e-06
        1.449004445169e-06
        1.372558849293e-06
        1.306310577635e-06
        1.237632234188e-06
        1.178561972622e-06
        1.117223639235e-06
        1.064307282767e-06
        1.009900520049e-06
        9.630252693371e-07
        9.133531116614e-07
        8.706297500929e-07
        8.254943631810e-07
        7.871287867875e-07
        7.460099179111e-07
        7.103621851733e-07
        6.730489998548e-07
        6.409208555816e-07
        6.073778376540e-07
        5.784512816696e-07
        5.484203034616e-07
        5.223750986734e-07
        4.953324537722e-07
        4.712621342993e-07
        4.470701277242e-07
        4.253974245799e-07
        4.032589726701e-07
        3.842462768513e-07
        3.641005347422e-07
        3.470959751060e-07
        3.286289801865e-07
        3.125660063336e-07
        2.958102986954e-07
        2.812510280078e-07
        2.665904036351e-07
        2.536953085550e-07
        2.406444569217e-07
        2.290942899296e-07
        2.171880890010e-07
        2.064389295279e-07
        1.955064054537e-07
        1.857108615035e-07
        1.755129756661e-07
        1.666217962778e-07
        1.575461416661e-07
        1.496164408802e-07
        1.415449239926e-07
        1.345247719689e-07
        1.274330508135e-07
        1.213231937201e-07
        1.149824137982e-07
        1.094449848427e-07
        1.037359568630e-07
        9.872368120545e-08
        9.343133614211e-08
        8.896311771921e-08
        8.415435668171e-08
        8.006830327141e-08
        7.571314389513e-08
        7.199604658636e-08
        6.815537994287e-08
        6.479992469798e-08
        6.135812582171e-08
        5.836525920742e-08
        5.524570280585e-08
        5.252151178630e-08
        4.968655529826e-08
        4.713349374340e-08
        4.454546145853e-08
        4.218649410087e-08
        3.980271061468e-08
        3.769140186965e-08
        3.554054031841e-08
        3.370068381331e-08
        3.178634551061e-08
        3.019894434198e-08
        2.853491686867e-08
        2.715187735622e-08
        2.567785969937e-08
        2.439921853659e-08
        2.309085789481e-08
    ];

last = size(smallfem, 1);
it = [1:size(smallfem, 1)];

semilogy(it, ...
         getdp(1:last),             '-o', 'linewidth', 3, ...
         smallfem(1:last),          '-o', 'linewidth', 3, ...
         getdp(1:last) ./ smallfem(1:last), '-*', 'linewidth', 3);
legend({'GetDP', 'SmallFEM', 'GetDP / SmallFEM'}, 'location', 'SouthWest');
title('Vectorial EMDA: 4 domains');
xlabel('Iteration');
ylabel('Residual');

print('vemda.png');